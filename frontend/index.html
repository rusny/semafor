<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Simulácia križovatky - Konfigurácia</title>
  <style>
    :root {
      --bg: #f5f5f5;
      --panel-bg: #ffffff;
      --accent: #2c7be5;
      --text: #333333;
      --border: #dddddd;
      --radius: 8px;
      --gap: 1rem;
    }
    body { font-family: Arial, sans-serif; background: var(--bg); color: var(--text); margin: var(--gap); }
    h1 { text-align: center; margin-bottom: var(--gap); }
    .controls { max-width: 600px; margin: 0 auto; background: var(--panel-bg); padding: var(--gap); border: 1px solid var(--border); border-radius: var(--radius); }
    .direction-group { margin-bottom: var(--gap); }
    .direction-group h2 { margin-bottom: 0.5rem; color: var(--accent); }
    .lane-config { display: flex; align-items: center; margin-bottom: 0.5rem; }
    .lane-config span { width: 60px; }
    .radios label { margin-right: 0.5rem; cursor: pointer; }
    .intervals input { width: 80px; margin-right: 0.5rem; padding: 0.25rem; border: 1px solid var(--border); border-radius: var(--radius); }
    #sendBtn { display: block; margin: var(--gap) auto; padding: 0.75rem 1.5rem; background: var(--accent); color: #fff; border: none; border-radius: var(--radius); cursor: pointer; }
    #status { text-align: center; margin-top: var(--gap); font-weight: bold; }
  </style>
</head>
<body>
  <h1>Konfigurácia križovatky</h1>
  <div class="controls" id="controls"></div>
  <button id="sendBtn">Odoslať konfiguráciu</button>
  <div id="status"></div>

  <script>
    const API = 'http://localhost:8085';
    const dirs = ['north','east','south','west'];
    const names= {north:'Sever',east:'Východ',south:'Juh',west:'Západ'};
    const symbols = {left:'←',straight:'↑',right:'→'};
    const controls = document.getElementById('controls');
    const statusEl = document.getElementById('status');

    function buildControls() {
      dirs.forEach(dir => {
        const grp = document.createElement('div'); grp.className='direction-group';
        grp.innerHTML = `<h2>${names[dir]}</h2>`;
        for(let i=1;i<=3;i++){
          const lane = document.createElement('div'); lane.className='lane-config';
          lane.innerHTML = `<span>Pruh ${i}:</span>`;
          const rad = document.createElement('div'); rad.className='radios';
          ['left','straight','right'].forEach(d=>{
            const id = `${dir}-${i}-${d}`;
            rad.innerHTML += `<label><input type="checkbox" id="${id}"> ${symbols[d]}</label>`;
          });
          const iv = document.createElement('div'); iv.className='intervals';
          iv.innerHTML = `Od: <input type="number" id="${dir}-${i}-from" min="0" placeholder="0"> ` +
                         `Do: <input type="number" id="${dir}-${i}-to" min="0" placeholder="0">`;
          lane.append(rad, iv);
          grp.append(lane);
        }
        controls.append(grp);
      });
    }

    function gatherConfig() {
      const conf = { phases: {} };
      dirs.forEach(dir => {
        conf.phases[dir] = {};
        ['left','straight','right'].forEach(d => {
          for(let i=1;i<=3;i++){
            const cb = document.getElementById(`${dir}-${i}-${d}`);
            if(cb && cb.checked){
              const f = parseInt(document.getElementById(`${dir}-${i}-from`).value) || 0;
              const t = parseInt(document.getElementById(`${dir}-${i}-to`).value) || 0;
              conf.phases[dir][d] = { start: f, end: t };
            }
          }
        });
      });
      return conf;
    }

    async function sendConfig() {
      const cfg = gatherConfig();
      statusEl.textContent = 'Odosielam konfiguráciu...';
      try {
        const resp = await fetch(API + '/set_phases', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(cfg)
        });
        const data = await resp.json();
        if(data.success) {
          statusEl.textContent = 'Konfigurácia úspešne odoslaná.';
        } else {
          statusEl.textContent = 'Chyba: ' + data.message;
        }
      } catch (err) {
        statusEl.textContent = 'Chyba pri odoslaní.';
      }
    }

    document.getElementById('sendBtn').addEventListener('click', sendConfig);
    buildControls();
  </script>
</body>
</html>

